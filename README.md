# Mini RAG Chatbot

–ú–∏–Ω–∏ RAG —á–∞—Ç–±–æ—Ç —Å –æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ –¥–æ–æ–±—É—á–∞–≤–∞–Ω–µ, –∏–∑–≥—Ä–∞–¥–µ–Ω —Å Python –∏ PostgreSQL.

## üéØ –¶–µ–ª

–ú–∏–Ω–∏–º–∞–ª–µ–Ω, –Ω–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–µ–Ω –ø—Ä–æ—Ç–æ—Ç–∏–ø –Ω–∞ —á–∞—Ç–±–æ—Ç, –∫–æ–π—Ç–æ:
- –û—Ç–≥–æ–≤–∞—Ä—è –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏ –≤—ä—Ä—Ö—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–µ–Ω–∏ –¥–∞–Ω–Ω–∏ (RAG –ø–æ–¥—Ö–æ–¥)
- –ü–æ–∫–∞–∑–≤–∞ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∏/–∑–∞–≥–ª–∞–≤–∏—è)
- –ò–∑—á–∏—Å–ª—è–≤–∞ score (0‚Äì100) –∑–∞ —É–≤–µ—Ä–µ–Ω–æ—Å—Ç/—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç
- –ü—Ä–∏ score < 80 –≤—Ä—ä—â–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ: ‚Äû–¢–æ–≤–∞ –Ω–µ –µ –≤ –º–æ—è—Ç–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è"

## üöÄ –ë—ä—Ä–∑–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ

### 1. –ö–ª–æ–Ω–∏—Ä–∞–Ω–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
git clone https://github.com/SrebrinSharbanov/ChatBot.git
cd ChatBot
```

### 2. GPU Setup (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)
```bash
# –ü—Ä–æ–≤–µ—Ä–∏ GPU –ø–æ–¥–¥—Ä—ä–∂–∫–∞
nvidia-smi

# –ó–∞ GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤–∏–∂ GPU_SETUP.md
```

### 3. –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ —Å Docker
```bash
cd docker
docker-compose up -d
```

### 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ
```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec -it mini-rag-chatbot python scripts/prepare_data.py
docker exec -it mini-rag-chatbot python scripts/build_index.py
```

### 5. –¢–µ—Å—Ç–≤–∞–Ω–µ
```bash
# Health check
curl http://localhost:8000/api/health

# –ü—Ä–∏–º–µ—Ä–Ω–∞ –∑–∞—è–≤–∫–∞
curl -X POST http://localhost:8000/api/query \
  -H "Content-Type: application/json" \
  -d '{"q":"–ö–∞–∫–≤–∞ –µ –ø–æ–ª–∏—Ç–∏–∫–∞—Ç–∞ –∑–∞ –≤—Ä—ä—â–∞–Ω–µ?", "k":5}'

# Frontend –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
open http://localhost:8000/api/frontend

# –†–∞–∑—à–∏—Ä–µ–Ω–∏ —é–Ω–∏—Ç —Ç–µ—Å—Ç–æ–≤–µ (150+ —Ç–µ—Å—Ç —Å–ª—É—á–∞—è)
docker exec -it mini-rag-chatbot python unit_test_chatbot.py

# –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
docker exec -it mini-rag-chatbot python unit_test_chatbot.py --category "–ø—Ä–æ–¥—É–∫—Ç–∏"

# –°–ø–∏—Å—ä–∫ —Å –≤—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
docker exec -it mini-rag-chatbot python unit_test_chatbot.py --list-categories
```

## üß™ –¢–µ—Å—Ç–≤–∞–Ω–µ –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è

### **üìä –†–∞–∑—à–∏—Ä–µ–Ω–∏ –Æ–Ω–∏—Ç –¢–µ—Å—Ç–æ–≤–µ**
- **150+ —Ç–µ—Å—Ç —Å–ª—É—á–∞—è** –ø–æ–∫—Ä–∏–≤–∞—â–∏ –≤—Å–∏—á–∫–∏ –æ—Å–Ω–æ–≤–Ω–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- **12 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤–µ**: –ø—Ä–æ–¥—É–∫—Ç–∏, –ø–ª–∞—â–∞–Ω–µ, –¥–æ—Å—Ç–∞–≤–∫–∞, –≥–∞—Ä–∞–Ω—Ü–∏—è, —Ä–∞–±–æ—Ç–Ω–æ –≤—Ä–µ–º–µ, –∫–æ–Ω—Ç–∞–∫—Ç–∏, –ø–æ–ª–∏—Ç–∏–∫–∏, —Ü–µ–Ω–∏, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤—ä–ø—Ä–æ—Å–∏, edge cases, —Å–ª–æ–∂–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**: —Å—Ä–µ–¥–µ–Ω score, success rate, –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–æ —Ä–∞–∑–±–∏–≤–∞–Ω–µ
- **–ì—ä–≤–∫–∞–≤–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ**: –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç –∑–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–ª–∏ –≤—Å–∏—á–∫–∏ –Ω–∞–≤–µ–¥–Ω—ä–∂

### **üéØ –¢–µ—Å—Ç –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
1. **–ü—Ä–æ–¥—É–∫—Ç–∏ - –æ–±—â–∏** (8 —Ç–µ—Å—Ç–∞): –æ–±—â–∏ –≤—ä–ø—Ä–æ—Å–∏ –∑–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
2. **–ü—Ä–æ–¥—É–∫—Ç–∏ - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** (15 —Ç–µ—Å—Ç–∞): —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –∫–∞—Ç–æ –ª–∞–ø—Ç–æ–ø–∏, —Ç–µ–ª–µ—Ñ–æ–Ω–∏, —á–∞—Å–æ–≤–Ω–∏—Ü–∏
3. **–ü–ª–∞—â–∞–Ω–µ –∏ –ø–æ—Ä—ä—á–∫–∏** (15 —Ç–µ—Å—Ç–∞): –º–µ—Ç–æ–¥–∏ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ, –ø–æ—Ä—ä—á–∫–∏
4. **–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ** (15 —Ç–µ—Å—Ç–∞): —Å—Ä–æ–∫–æ–≤–µ, –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–∞—Ç–∫–∏
5. **–ì–∞—Ä–∞–Ω—Ü–∏—è –∏ —Å–µ—Ä–≤–∏–∑** (15 —Ç–µ—Å—Ç–∞): –≥–∞—Ä–∞–Ω—Ü–∏–∏, —Ä–µ–º–æ–Ω—Ç–∏, —Ä–µ–∫–ª–∞–º–∞—Ü–∏–∏
6. **–†–∞–±–æ—Ç–Ω–æ –≤—Ä–µ–º–µ** (15 —Ç–µ—Å—Ç–∞): –≥—Ä–∞—Ñ–∏–∫, –ø–æ—á–∏–≤–Ω–∏ –¥–Ω–∏
7. **–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** (15 —Ç–µ—Å—Ç–∞): —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å, email
8. **–ü–æ–ª–∏—Ç–∏–∫–∏ –∏ —É—Å–ª–æ–≤–∏—è** (15 —Ç–µ—Å—Ç–∞): –≤—Ä—ä—â–∞–Ω–µ, –æ—Ç–º—è–Ω–∞, —É—Å–ª–æ–≤–∏—è
9. **–¶–µ–Ω–∏ –∏ –ø—Ä–æ–º–æ—Ü–∏–∏** (15 —Ç–µ—Å—Ç–∞): —Ü–µ–Ω–∏, –æ—Ç—Å—Ç—ä–ø–∫–∏, –∞–∫—Ü–∏–∏
10. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤—ä–ø—Ä–æ—Å–∏** (15 —Ç–µ—Å—Ç–∞): –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –¥—Ä–∞–π–≤–µ—Ä–∏
11. **Edge Cases** (15 —Ç–µ—Å—Ç–∞): –≤—ä–ø—Ä–æ—Å–∏ –∏–∑–≤—ä–Ω –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è—Ç–∞
12. **–°–ª–æ–∂–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏** (10 —Ç–µ—Å—Ç–∞): –∫–æ–º–±–∏–Ω–∏—Ä–∞–Ω–∏ –∑–∞—è–≤–∫–∏

### **üìà –¢–µ—Å—Ç –†–µ–∑—É–ª—Ç–∞—Ç–∏:**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑—á–∏—Å–ª—è–≤–∞–Ω–µ** –Ω–∞ —Å—Ä–µ–¥–µ–Ω score –∏ success rate
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–æ —Ä–∞–∑–±–∏–≤–∞–Ω–µ** –ø–æ–∫–∞–∑–≤–∞—â–æ –±—Ä–æ—è —Ç–µ—Å—Ç–æ–≤–µ –∑–∞ –≤—Å—è–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
- **–î–µ—Ç–∞–π–ª–Ω–∏ –ª–æ–≥–æ–≤–µ** –∑–∞ –≤—Å–µ–∫–∏ —Ç–µ—Å—Ç —Å score, –æ—Ç–≥–æ–≤–æ—Ä –∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏
- **Performance –º–µ—Ç—Ä–∏–∫–∏** –∑–∞ –≤—Ä–µ–º–µ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä

### **üîß –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ –¢–µ—Å—Ç–æ–≤–µ—Ç–µ:**
```bash
# –ü—ä–ª–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ (–≤—Å–∏—á–∫–∏ 150+ —Ç–µ—Å—Ç–∞)
python unit_test_chatbot.py

# –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
python unit_test_chatbot.py --category "–ø—Ä–æ–¥—É–∫—Ç–∏"

# –°–ø–∏—Å—ä–∫ —Å –≤—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
python unit_test_chatbot.py --list-categories

# –¢–µ—Å—Ç–≤–∞–Ω–µ —Å —Ä–∞–∑–ª–∏—á–µ–Ω URL
python unit_test_chatbot.py --url http://localhost:8001
```

## ‚ú® –ù–æ–≤–∏ –§—É–Ω–∫—Ü–∏–∏

### **üáßüá¨ Bulgarian Post-Processing**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–≥–ª–∞–∂–¥–∞–Ω–µ** –Ω–∞ –≥—Ä–∞–º–∞—Ç–∏–∫–∞ –∏ –ø—Ä–∞–≤–æ–ø–∏—Å –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏
- **–°—Ç–∏–ª–∏—Å—Ç–∏—á–Ω–∏ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è** –∑–∞ –ø–æ-–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏
- **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω –≤ RAG pipeline** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–µ –ø—Ä–∏–ª–∞–≥–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏

### **üì± –ö–æ–º–ø–∞–∫—Ç–µ–Ω Frontend**
- **–î–≤—É–∫–æ–ª–æ–Ω–µ–Ω layout** - —á–∞—Ç –≤–ª—è–≤–æ, FAQ –≤–¥—è—Å–Ω–æ
- **–§–∏–∫—Å–∏—Ä–∞–Ω–∞ –≤–∏—Å–æ—á–∏–Ω–∞** - –±–µ–∑ —Å–∫—Ä–æ–ª –Ω–∞ —Ü—è–ª–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- **Responsive design** - –∞–¥–∞–ø—Ç–∏—Ä–∞ —Å–µ –∑–∞ –º–æ–±–∏–ª–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- **Input –ø–æ–ª–µ—Ç–æ –Ω–∞–π-–¥–æ–ª—É** - –ª–æ–≥–∏—á–Ω–æ —Ä–∞–∑–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ç–æ –≤ –∏—Å—Ç–∏–Ω—Å–∫–∏ —á–∞—Ç

### **üé≤ Random FAQ**
- **6 —Å–ª—É—á–∞–π–Ω–∏ FAQ** –≤–º–µ—Å—Ç–æ –≤—Å–∏—á–∫–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ refresh** —Å–ª–µ–¥ –≤—Å–µ–∫–∏ –æ—Ç–≥–æ–≤–æ—Ä
- **–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –≤—Å–µ–∫–∏ –ø—ä—Ç —Ä–∞–∑–ª–∏—á–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏

### **üß† Advanced Intent Recognition**
- **Double-pass semantic check** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ –≥—Ä–µ—à–Ω–∏ alias –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- **–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ–Ω fallback** - —Ö–≤–∞—â–∞ –≥–ª–∞–≥–æ–ª–Ω–∏ —Ñ–æ—Ä–º–∏ –∫–∞—Ç–æ "–ü–ª–∞—â–∞ –ª–∏ —Å–µ?"
- **Dynamic synonym weighting** - —Å–∞–º–æ –Ω–∞–π-—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ç–µ 3 —Å–∏–Ω–æ–Ω–∏–º–∞
- **Context boosters** - –¥–æ–±–∞–≤—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ —Ç–µ—Ä–º–∏–Ω–∏ –∑–∞ –≤—Å–µ–∫–∏ intent
- **Semantic stability** - –ø—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞ –∑–∞–ø–∞–∑–≤–∞ —Å–º–∏—Å—ä–ª–∞

### **‚ö° Performance Optimizations**
- **Compiled regex patterns** - –ø–æ-–±—ä—Ä–∑–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ post-processing
- **Reduced logging** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∏ –ª–æ–≥–æ–≤–µ –∑–∞ production
- **Timeout handling** - —Å—Ç–∞–±–∏–ª–Ω–∏ 120s timeout –∑–∞ Ollama
- **Retry logic** - —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–∏ –≥—Ä–µ—à–∫–∏

### **üõçÔ∏è Products Query Handler**
- **–î–∏—Ä–µ–∫—Ç–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–æ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏** - –ø—Ä–∏ products intent –∏–∑–≤–ª–∏—á–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç PostgreSQL
- **–ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ** - –ø–æ–∫–∞–∑–≤–∞ –∏–º–µ, —Ü–µ–Ω–∞ –∏ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞ –≤—Å–µ–∫–∏ –ø—Ä–æ–¥—É–∫—Ç
- **–í–∏—Å–æ–∫ score (95/100)** - –¥–∏—Ä–µ–∫—Ç–Ω–∏ –¥–∞–Ω–Ω–∏ –æ—Ç –±–∞–∑–∞—Ç–∞ –∏–º–∞—Ç –Ω–∞–π-–≤–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- **Fallback –º–µ—Ö–∞–Ω–∏–∑—ä–º** - –ø—Ä–∏ –≥—Ä–µ—à–∫–∞ —Å–µ –≤—Ä—ä—â–∞ –∫—ä–º –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ—Ç–æ —Ç—ä—Ä—Å–µ–Ω–µ
- **Pydantic validation** - –ø—Ä–∞–≤–∏–ª–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–∏ sources —Å segment_id

### **üéØ Smart Product Filtering with LLM Generation**
#### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
User Query ‚Üí Intent Recognition ‚Üí Product Keywords Extraction 
    ‚Üì
Keyword-based SQL Filter (FIRST - fast & precise)
    ‚Üì
Sufficient Results? 
    ‚îú‚îÄ YES ‚Üí Use keyword results
    ‚îî‚îÄ NO ‚Üí Fallback to Vector Search (comprehensive)
    ‚Üì
Format Products for LLM 
    ‚Üì
LLM Generation (Natural Language)
    ‚Üì
Response with Sources & Score
```

#### **Hybrid Retrieval –ú–µ—Ö–∞–Ω–∏–∑—ä–º:**

**üîç –î–≤—É—Å—Ç—ä–ø–µ–Ω –ø–æ–¥—Ö–æ–¥:**

1. **Keyword-based Search (FIRST)**
   - –ë—ä—Ä–∑–æ SQL —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –ø–æ name, description, category
   - –¢–æ—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ - –∏–∑–±—è–≥–≤–∞ "—Ä–∞–∑–ª–∏–≤–∞–Ω–µ—Ç–æ" –∫—ä–º –Ω–µ—Å–≤—ä—Ä–∑–∞–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏
   - ~20-50ms –∑–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ

2. **Vector Search (Fallback)**
   - –ê–∫–æ keyword search –¥–∞–¥–µ < 2 —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
   - –ò–∑–ø–æ–ª–∑–≤–∞ embedding-–∏ –∑–∞ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ
   - –ü–æ-–≤—Å–µ–æ–±—Ö–≤–∞—Ç–Ω–∏, –Ω–æ –ø–æ-–±–∞–≤–Ω–∏ (~100-200ms)
   - –•–≤–∞—â–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ —Å –ø–æ–¥–æ–±–µ–Ω —Å–º–∏—Å—ä–ª –¥–æ—Ä–∏ –±–µ–∑ —Ç–æ—á–Ω–∏ –¥—É–º–∏

**–ü—Ä–∏–º–µ—Ä:**
```
–í—ä–ø—Ä–æ—Å: "–ü—Ä–µ–¥–ª–∞–≥–∞—Ç–µ –ª–∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏?"

–°—Ç—ä–ø 1: Keyword Search
‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏: ["—Ç–µ–ª–µ—Ñ–æ–Ω"]
‚îú‚îÄ SQL WHERE: name ILIKE '%—Ç–µ–ª–µ—Ñ–æ–Ω%' OR description ILIKE '%—Ç–µ–ª–µ—Ñ–æ–Ω%'
‚îú‚îÄ –ù–∞–º–µ—Ä–µ–Ω–∏: 3 —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞ ‚Üí OK, –∏–∑–ø–æ–ª–∑–≤–∞–º–µ —Ç–µ–∑–∏!
‚îî‚îÄ –í—Ä–µ–º–µ: 25ms

–û—Ç–≥–æ–≤–æ—Ä: "–î–∞, –ø—Ä–µ–¥–ª–∞–≥–∞–º–µ Samsung Galaxy S23, iPhone 13..."
```

**Fallback –ø—Ä–∏–º–µ—Ä:**
```
–í—ä–ø—Ä–æ—Å: "–ö–∞–∫–≤–∏ —Å–∞ –≤–∞—à–∏—Ç–µ –ø—Ä–µ–º–∏—É–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞?"

–°—Ç—ä–ø 1: Keyword Search
‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏: [] (–Ω—è–º–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏—Ç–µ)
‚îú‚îÄ –ù–∞–º–µ—Ä–µ–Ω–∏: 0 –ø—Ä–æ–¥—É–∫—Ç–∞ ‚Üí –ù–ï OK
‚îî‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞ fallback...

–°—Ç—ä–ø 2: Vector Search (Fallback)
‚îú‚îÄ Embedding —Ç—ä—Ä—Å–µ–Ω–µ: "–ø—Ä–µ–º–∏—É–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"
‚îú‚îÄ –ù–∞–º–µ—Ä–µ–Ω–∏: 8 –ø—Ä–æ–¥—É–∫—Ç–∞ (–ª–∞–ø—Ç–æ–ø–∏, —á–∞—Å–æ–≤–Ω–∏—Ü–∏, –∫–∞–º–µ—Ä–∏)
‚îî‚îÄ –í—Ä–µ–º–µ: 150ms

–û—Ç–≥–æ–≤–æ—Ä: "–í –Ω–∞—à–∏—è –∫–∞—Ç–∞–ª–æ–≥ –∏–º–∞–º–µ –Ω—è–∫–æ–ª–∫–æ –ø—Ä–µ–º–∏—É–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞..."
```

#### **üöÄ Category Expansion - –†–∞–∑—à–∏—Ä–µ–Ω–æ –ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–æ –°—ä–≤–ø–∞–¥–µ–Ω–∏–µ:**

**–ü—Ä–æ–±–ª–µ–º:** –ë–∞–∑–∞—Ç–∞ –º–æ–∂–µ –¥–∞ –∏–º–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ("Electronics") –∏–ª–∏ —Ä–∞–∑–ª–∏—á–Ω–∏ –Ω–∞–∑–æ–≤–∏, –∫–æ–∏—Ç–æ –Ω–µ —Å—ä–≤–ø–∞–¥–∞—Ç —Å –∫–æ—Ä–∏—Å—Ç–µ–ª—Å–∫–∏—è –≤—ä–ø—Ä–æ—Å.

**–†–µ—à–µ–Ω–∏–µ:** CATEGORY_MAP —Å —Å–∏–Ω–æ–Ω–∏–º–∏ –∑–∞ –≤—Å—è–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è:

```python
CATEGORY_MAP = {
    "—Ç–µ–ª–µ—Ñ–æ–Ω": ["—Ç–µ–ª–µ—Ñ–æ–Ω–∏", "—Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏", "–º–æ–±–∏–ª–Ω–∏", "mobile", "phones", "smartphones", "cellphone", "electronics", "devices"],
    "–ª–∞–ø—Ç–æ–ø": ["–ª–∞–ø—Ç–æ–ø–∏", "–Ω–æ—É—Ç–±—É—Ü–∏", "notebooks", "computers", "portable", "computing"],
    "—á–∞—Å–æ–≤–Ω–∏–∫": ["—á–∞—Å–æ–≤–Ω–∏—Ü–∏", "wearables", "–∞–∫—Å–µ—Å–æ–∞—Ä–∏", "accessories", "wearable"],
    "–¥—Ä–µ—Ö–∏": ["–æ–±–ª–µ–∫–ª–æ", "apparel", "clothing", "fashion", "wear"],
    ...
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∏:**

```
–í—ä–ø—Ä–æ—Å: "–ò–º–∞—Ç–µ –ª–∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏?"
     ‚Üì
Keyword extraction: ["—Ç–µ–ª–µ—Ñ–æ–Ω"]
     ‚Üì
CATEGORY_MAP lookup: ["—Ç–µ–ª–µ—Ñ–æ–Ω"] ‚Üí —Å–∏–Ω–æ–Ω–∏–º–∏ + —Ä–∞–∑—à–∏—Ä–µ–Ω–∏—è
     ‚Üì
SQL WHERE —É—Å–ª–æ–≤–∏–µ —Å 60+ –≤–∞—Ä–∏–∞—Ü–∏–∏:
   - name LIKE '%—Ç–µ–ª–µ—Ñ–æ–Ω%'
   - name LIKE '%—Å–º–∞—Ä—Ç—Ñ–æ–Ω%'
   - name LIKE '%mobile%'
   - category LIKE '%phones%'
   - category LIKE '%electronics%'
   ...
     ‚Üì
–ù–∞–º–µ—Ä—è "Samsung Galaxy S23" –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è "Electronics"
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
‚úÖ –•–≤–∞—Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ —Å—ä—Å –∞–Ω–≥–ª–∏–π—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚úÖ –†–∞–±–æ—Ç–∏ —Å—ä—Å —Å–∏–Ω–æ–Ω–∏–º–∏ (—Å–º–∞—Ä—Ç—Ñ–æ–Ω = —Ç–µ–ª–µ—Ñ–æ–Ω)
‚úÖ Case-insensitive matching (LOWER –≤ SQL)
‚úÖ –ü–æ—á—Ç–∏ 100% —Ç–æ—á–Ω–æ—Å—Ç –∑–∞ –∏–∑–≤–µ—Å—Ç–Ω–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

#### **üîÄ Merge_results - –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ Keyword –∏ Vector –†–µ–∑—É–ª—Ç–∞—Ç–∏:**

**–ö–æ–≥–∞—Ç–æ –∏–º–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ keyword —Ä–µ–∑—É–ª—Ç–∞—Ç–∏, —Å–∏—Å—Ç–µ–º–∞—Ç–∞:**

1. **–ó–∞–ø–∞–∑–≤–∞ keyword —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ** (score = 1.0)
2. **–î–æ–±–∞–≤—è vector —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ** (score = similarity * 0.75)
3. **–î–µ–¥—É–ø–ª–∏–∫–∏—Ä–∞** - –≤—Å–µ–∫–∏ –ø—Ä–æ–¥—É–∫—Ç —Å–µ –ø–æ—è–≤—è–≤–∞ —Å–∞–º–æ –≤–µ–¥–Ω—ä–∂
4. **–°–æ—Ä—Ç–∏—Ä–∞** –ø–æ –æ–±–æ–±—â–µ–Ω score

**–ü—Ä–∏–º–µ—Ä:**

```
Keyword Search —Ä–µ–∑—É–ª—Ç–∞—Ç–∏:
  - Samsung Galaxy S23 (score: 1.0)
  - iPhone 13 Mini (score: 1.0)

Vector Search —Ä–µ–∑—É–ª—Ç–∞—Ç–∏:
  - Sony WH-1000XM5 (similarity: 0.8 ‚Üí score: 0.6)
  - Samsung Galaxy S23 (similarity: 0.95 ‚Üí score: 0.71)  # –î—É–±–ª–∏—Ä–∞–Ω, –ø—Ä–æ–ø—É—Å–∫–∞ —Å–µ
  - LG Monitor (similarity: 0.7 ‚Üí score: 0.525)

–§–∏–Ω–∞–ª–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ (—Å–æ—Ä—Ç–∏—Ä–∞–Ω–∏ –ø–æ score):
  1. Samsung Galaxy S23 (score: 1.0)      ‚Üê Keyword match
  2. iPhone 13 Mini (score: 1.0)           ‚Üê Keyword match
  3. Sony WH-1000XM5 (score: 0.6)          ‚Üê Vector match
  4. LG Monitor (score: 0.525)             ‚Üê Vector match
```

**–ê–¥–∞–ø—Ç–∏–≤–µ–Ω Score:**
- **Keyword Match:** response_score = **95** (–≤–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- **Hybrid Match:** response_score = **85** (–∫–æ–º–±–∏–Ω–∏—Ä–∞–Ω–æ)
- **Vector Fallback:** response_score = **75** (–ø–æ-–Ω–∏—Å—ä–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### **–ü—Ä–∏–º–µ—Ä–∏ –Ω–∞ –†–µ–∞–ª–Ω–∞ –†–∞–±–æ—Ç–∞:**

**–ü—Ä–∏–º–µ—Ä 1: –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å—ä—Å category expansion**
```
üìù –í—ä–ø—Ä–æ—Å: "–ü—Ä–µ–¥–ª–∞–≥–∞—Ç–µ –ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏?"

üîç –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Intent: products (confidence: 0.92)
2. Keywords extracted: ["—Ç–µ–ª–µ—Ñ–æ–Ω"]
3. Category expansion: ["—Ç–µ–ª–µ—Ñ–æ–Ω", "—Å–º–∞—Ä—Ç—Ñ–æ–Ω", "mobile", "phones", "electronics", ...]
4. SQL Filter: 60+ —É—Å–ª–æ–≤–∏—è —Å –≤—Å–∏—á–∫–∏ –≤–∞—Ä–∏–∞—Ü–∏–∏
5. Products found: 3 (Samsung Galaxy S23, iPhone 13, Xiaomi Redmi)
6. Search method: keyword

üí¨ –û—Ç–≥–æ–≤–æ—Ä (–æ—Ç LLM):
"–î–∞, –≤ –º–æ–º–µ–Ω—Ç–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–º–µ –Ω—è–∫–æ–ª–∫–æ –æ—Ç–ª–∏—á–µ–Ω –º–æ–¥–µ–ª–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏:
Samsung Galaxy S23 –µ —Ñ–ª–∞–≥–º–∞–Ω—Å–∫–∏ –º–æ–¥–µ–ª —Å (1899 –ª–≤)
iPhone 13 Mini –µ –∫–æ–º–ø–∞–∫—Ç–µ–Ω –∏ –º–æ—â–µ–Ω (999 –ª–≤)
Xiaomi Redmi Note 13 –ø—Ä–µ–¥–ª–∞–≥–∞ –Ω–∞–π-–¥–æ–±—Ä–∞—Ç–∞ —Ü–µ–Ω–∞-–∫–∞—á–µ—Å—Ç–≤–æ (349 –ª–≤)
–í—Å–∏—á–∫–∏ —Å–∞ –Ω–∞–ª–∏—á–Ω–∏ —Å 24 –º–µ—Å–µ—Ü–∞ –≥–∞—Ä–∞–Ω—Ü–∏—è."

Score: 95/100 (Keyword match)
Sources: [products:1, products:2, products:3]
```

**–ü—Ä–∏–º–µ—Ä 2: –•–∏–±—Ä–∏–¥–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ (keyword + vector merge)**
```
üìù –í—ä–ø—Ä–æ—Å: "–ö–∞–∫–≤–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–º–∞—Ç–µ?"

üîç –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Keywords extracted: [] (–Ω—è–º–∞ —Ç–æ—á–µ–Ω match)
2. Keyword search: 0 —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
3. Fallback activated: Vector search
4. Vector results: 8 –ø—Ä–æ–¥—É–∫—Ç–∞ (—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–∏ tech)
5. Merge results: –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ keyword (0) + vector (8)
6. Search method: hybrid

üí¨ –û—Ç–≥–æ–≤–æ—Ä (–æ—Ç LLM):
"–ù–∞—à–∏—è—Ç –∫–∞—Ç–∞–ª–æ–≥ –≤–∫–ª—é—á–≤–∞ —à–∏—Ä–æ–∫–∞ –≥–∞–º–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
–°–º–∞—Ä—Ç—Ñ–æ–Ω–∏ - Samsung Galaxy S23, iPhone 13 (–æ—Ç 999 –¥–æ 1899 –ª–≤)
–õ–∞–ø—Ç–æ–ø–∏ - Dell XPS 13, Lenovo ThinkPad (–æ—Ç 1299 –¥–æ 2499 –ª–≤)
–ê–∫—Å–µ—Å–æ–∞—Ä–∏ - —Å–ª—É—à–∞–ª–∫–∏, —á–∞—Å–æ–≤–Ω–∏—Ü–∏, –∫–∞–º–µ—Ä–∏
–í—Å–∏—á–∫–∏ —Å –≥–∞—Ä–∞–Ω—Ü–∏—è –∏ –ø–æ–¥–¥—Ä—ä–∂–∫–∞."

Score: 85/100 (Hybrid match)
```

**–ü—Ä–∏–º–µ—Ä 3: –ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏**
```
üìù –í—ä–ø—Ä–æ—Å: "–ü—Ä–æ–¥–∞–≤–∞—Ç–µ –ª–∏ —Ö–µ–ª–∏–∫–æ–ø—Ç–µ—Ä–∏?"

üîç –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Keywords extracted: [] (—Ö–µ–ª–∏–∫–æ–ø—Ç–µ—Ä –µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
2. Keyword search: 0 —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
3. Vector search: 0 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
4. Merge: –ø—É—Å—Ç–æ

üí¨ –û—Ç–≥–æ–≤–æ—Ä:
"–í –º–æ–º–µ–Ω—Ç–∞ –Ω–µ –æ—Ç–∫—Ä–∏–≤–∞–º –ø—Ä–æ–¥—É–∫—Ç–∏ –æ—Ç —Ç–æ–∑–∏ —Ç–∏–ø. 
–í–∏–∂ –Ω–∞—à–∏—è –∫–∞—Ç–∞–ª–æ–≥ –∑–∞ –¥–æ—Å—Ç—ä–ø–Ω–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."

Score: 0/100
```

#### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∏ —Å—Ç—ä–ø–∫–∞ –ø–æ —Å—Ç—ä–ø–∫–∞:**

**1Ô∏è‚É£ Intent Recognition & Keyword Extraction**
```python
Query: "–ò–º–∞—Ç–µ –ª–∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏?"
‚Üì
ProductFilter.extract_keywords("–ò–º–∞—Ç–µ –ª–∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏?")
‚Üì
Result: ["—Ç–µ–ª–µ—Ñ–æ–Ω"]  # –†–∞–∑–ø–æ–∑–Ω–∞–≤–∞ —Å–∏–Ω–æ–Ω–∏–º–∏: —Å–º–∞—Ä—Ç—Ñ–æ–Ω, –º–æ–±–∏–ª–µ–Ω, —Ñ–æ–Ω, –∞–π—Ñ–æ–Ω, samsung
```

**2Ô∏è‚É£ Hybrid Search Logic**
```python
# –ü—ä—Ä–≤–æ: Keyword-based SQL (FAST)
keywords = ProductFilter.extract_keywords(query)
if keywords:
    sql = "SELECT ... WHERE name ILIKE '%{keyword}%' ..."
    results = db.execute(sql)
    
# –ê–∫–æ –Ω—è–º–∞ –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏: Vector search (FALLBACK)
if len(results) < 2:
    results = retriever.retrieve(query, top_k=10)
```

**3Ô∏è‚É£ Intelligent Filtering**
```python
# Check if keyword search is sufficient
should_fallback = ProductFilter.should_use_fallback(
    keyword_results=results,
    min_results=2  # –ú–∏–Ω–∏–º—É–º —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ OK
)

if should_fallback:
    # Use vector search instead
    results = vector_search(query)
```

**4Ô∏è‚É£ Format Products for LLM**
```
‚Ä¢ Samsung Galaxy A15 (–¢–µ–ª–µ—Ñ–æ–Ω) - 399.00 –ª–≤
  –°–º–∞—Ä—Ç—Ñ–æ–Ω —Å –¥–∏—Å–ø–ª–µ–π 6.5 –∏–Ω—á–∞, –±–∞—Ç–µ—Ä–∏—è 5000mAh...

‚Ä¢ iPhone 13 Mini (–¢–µ–ª–µ—Ñ–æ–Ω) - 999.00 –ª–≤
  –ö–æ–º–ø–∞–∫—Ç–µ–Ω —Ñ–ª–∞–≥–º–∞–Ω—Å–∫–∏ –º–æ–¥–µ–ª —Å A15 Bionic —á–∏–ø...
```

**5Ô∏è‚É£ LLM Generation (–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω –¢–µ–∫—Å—Ç)**
```
Prompt –∫—ä–º LLM:
"–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –ø–∏—Ç–∞: '–ò–º–∞—Ç–µ –ª–∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏?'

–ù–∞–ª–∏—á–Ω–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏:
‚Ä¢ Samsung Galaxy A15 - 399.00 –ª–≤
‚Ä¢ iPhone 13 Mini - 999.00 –ª–≤
‚Ä¢ Xiaomi Redmi Note 13 - 349.00 –ª–≤

–ù–∞–ø–∏—à–∏ –∫—Ä–∞—Ç—ä–∫ –æ—Ç–≥–æ–≤–æ—Ä..."

LLM Response:
"–î–∞, –≤ –º–æ–º–µ–Ω—Ç–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–º–µ –Ω—è–∫–æ–ª–∫–æ –æ—Ç–ª–∏—á–µ–Ω –º–æ–¥–µ–ª–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏:
Samsung Galaxy A15 –µ –∏–¥–µ–∞–ª–µ–Ω –∑–∞ –Ω–∞—á–∏–Ω–∞–µ—â–∏ (399 –ª–≤)
iPhone 13 Mini –µ –ø–µ—Ä—Ñ–µ–∫—Ç–Ω–∏—è—Ç –∏–∑–±–æ—Ä –∑–∞ Apple —Ñ–µ–Ω–æ–≤–µ (999 –ª–≤)
Xiaomi Redmi Note 13 –ø—Ä–µ–¥–ª–∞–≥–∞ –Ω–∞–π-–¥–æ–±—Ä–∞—Ç–∞ —Ü–µ–Ω–∞-–∫–∞—á–µ—Å—Ç–≤–æ (349 –ª–≤)
–í—Å–∏—á–∫–∏ —Å–∞ –Ω–∞–ª–∏—á–Ω–∏ —Å 24 –º–µ—Å–µ—Ü–∞ –≥–∞—Ä–∞–Ω—Ü–∏—è –∏ –±–µ–∑–ø–ª–∞—Ç–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞."
```

#### **–ü–æ–¥–¥—ä—Ä–∂–∞–Ω–∏ –ü—Ä–æ–¥—É–∫—Ç–æ–≤–∏ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
```python
"—Ç–µ–ª–µ—Ñ–æ–Ω" ‚Üí —Å–º–∞—Ä—Ç—Ñ–æ–Ω, –º–æ–±–∏–ª–µ–Ω, –º–æ–±–∏–ª–∫–∞, –∞–π—Ñ–æ–Ω, iphone, samsung, xiaomi
"–ª–∞–ø—Ç–æ–ø" ‚Üí notebook, –ø—Ä–µ–Ω–æ—Å–∏–º –∫–æ–º–ø—é—Ç—ä—Ä, —É–ª—Ç—Ä–∞–±—É–∫
"–∫–æ–º–ø—é—Ç—ä—Ä" ‚Üí –ø–∫, desktop, —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–µ–Ω
"—á–∞—Å–æ–≤–Ω–∏–∫" ‚Üí —Å–º–∞—Ä—Ç —á–∞—Å–æ–≤–Ω–∏–∫, smartwatch, wearable
"—Ç–∞–±–ª–µ—Ç" ‚Üí ipad, –ø–ª–∞–Ω—à–µ—Ç
"–æ–±—É–≤–∫–∏" ‚Üí –∫—Ä–æ—Å–æ–≤–∫–∏, –º–∞—Ä–∞—Ç–æ–Ω–∫–∏, –ø–∞–Ω—Ç–æ—Ñ–∏, –±–æ—Ç—É—à–∏
"–¥—Ä–µ—Ö–∏" ‚Üí –æ–±–ª–µ–∫–ª–æ, —Ç–µ–Ω–∏—Å–∫–∞, –ø–∞–Ω—Ç–∞–ª–æ–Ω, —è–∫–µ, –ø—É–ª–æ–≤–µ—Ä
"–≥—Ä–∞–¥–∏–Ω—Å–∫–∏" ‚Üí –≥—Ä–∞–¥–∏–Ω–∞, —Ü–≤–µ—Ç—è, —Ä–∞—Å—Ç–µ–Ω–∏—è, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
"—Å–ª—É—à–∞–ª–∫–∏" ‚Üí –Ω–∞—É—à–Ω–∏—Ü–∏, headphones, earbuds
"–∫–∞–º–µ—Ä–∞" ‚Üí —Ñ–æ—Ç–æ–∞–ø–∞—Ä–∞—Ç, –≤–∏–¥–µ–æ–∫–∞–º–µ—Ä–∞, –¥—Ä–æ–Ω
```

#### **–ü—Ä–∏–º–µ—Ä–∏ –Ω–∞ –†–∞–±–æ—Ç–∞:**

**–ü—Ä–∏–º–µ—Ä 1: –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è**
```
üìù –í—ä–ø—Ä–æ—Å: "–ü—Ä–µ–¥–ª–∞–≥–∞—Ç–µ –ª–∏ –ª–∞–ø—Ç–æ–ø–∏?"

üîç –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Intent: products (confidence: 0.92)
2. Keywords extracted: ["–ª–∞–ø—Ç–æ–ø"]
3. SQL Filter: WHERE name ILIKE '%–ª–∞–ø—Ç–æ–ø%' OR category ILIKE '%–ª–∞–ø—Ç–æ–ø%'
4. Products found: 3
5. LLM generates: "–î–∞, –∏–º–∞–º–µ –æ—Ç–ª–∏—á–µ–Ω –∏–∑–±–æ—Ä –æ—Ç –ª–∞–ø—Ç–æ–ø–∏..."

üí¨ –û—Ç–≥–æ–≤–æ—Ä:
"–î–∞, –ø—Ä–µ–¥–ª–∞–≥–∞–º–µ –Ω—è–∫–æ–ª–∫–æ –º–æ—â–Ω–∏ –ª–∞–ø—Ç–æ–ø–∞:

Dell XPS 13 (2499 –ª–≤) - –£–ª—Ç—Ä–∞—Ç–µ–Ω—ä–∫ —É–ª—Ç—Ä–∞–±—É–∫ –∑–∞ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–∏—Å—Ç–∏
Lenovo ThinkPad (1899 –ª–≤) - –ù–∞–¥–µ–∂–¥–µ–Ω –±–∏–∑–Ω–µ—Å –ª–∞–ø—Ç–æ–ø
ASUS VivoBook (1299 –ª–≤) - –ï–≤—Ç–∏–Ω –∏ –ø—Ä–∞–∫—Ç–∏—á–µ–Ω –≤–∞—Ä–∏–∞–Ω—Ç

–í—Å–∏—á–∫–∏ –≤–∫–ª—é—á–≤–∞—Ç Windows 11 –∏ 3 –≥–æ–¥–∏–Ω–∏ –≥–∞—Ä–∞–Ω—Ü–∏—è."

Score: 95/100
Sources: [products:1, products:2, products:3]
```

**–ü—Ä–∏–º–µ—Ä 2: –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è (fallback)**
```
üìù –í—ä–ø—Ä–æ—Å: "–ö–∞–∫–≤–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –∏–º–∞—Ç–µ?"

üîç –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Keywords extracted: []  (–Ω—è–º–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏)
2. Fallback: SELECT ... LIMIT 10 (–≤—Å–∏—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏)
3. LLM generates: "–ò–º–∞–º–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–µ–Ω –∫–∞—Ç–∞–ª–æ–≥ –æ—Ç..."

üí¨ –û—Ç–≥–æ–≤–æ—Ä:
"–ù–∞—à–∏—è—Ç –∫–∞—Ç–∞–ª–æ–≥ –≤–∫–ª—é—á–≤–∞:
- –¢–µ–ª–µ—Ñ–æ–Ω–∏ –∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∏ (–æ—Ç 299 –¥–æ 1999 –ª–≤)
- –õ–∞–ø—Ç–æ–ø–∏ –∏ –∫–æ–º–ø—é—Ç—Ä–∏ (–æ—Ç 999 –¥–æ 4999 –ª–≤)
- –ê–∫—Å–µ—Å–æ–∞—Ä–∏ (—Å–ª—É—à–∞–ª–∫–∏, –∫–∞–º–µ—Ä–∏, —á–∞—Å–æ–≤–Ω–∏—Ü–∏)
- –û–±–ª–µ–∫–ª–æ –∏ —Å–ø–æ—Ä—Ç–Ω–∏ —Å—Ç–æ–∫–∏
- –ì—Ä–∞–¥–∏–Ω—Å–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

–í–∏–∂ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∑–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏."

Score: 95/100
```

**–ü—Ä–∏–º–µ—Ä 3: –ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏**
```
üìù –í—ä–ø—Ä–æ—Å: "–ò–º–∞—Ç–µ –ª–∏ —Ö–µ–ª–∏–∫–æ–ø—Ç–µ—Ä–∏?"

üîç –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Keywords extracted: []  (—Ö–µ–ª–∏–∫–æ–ø—Ç–µ—Ä –Ω–µ –µ –≤ –∏–∑–≤–µ—Å—Ç–Ω–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
2. SQL Query: SELECT ... LIMIT 10
3. Products found: 0

üí¨ –û—Ç–≥–æ–≤–æ—Ä:
"–í –º–æ–º–µ–Ω—Ç–∞ –Ω–µ –æ—Ç–∫—Ä–∏–≤–∞–º –ø—Ä–æ–¥—É–∫—Ç–∏ –æ—Ç —Ç–æ–∑–∏ —Ç–∏–ø. 
–í–∏–∂ –Ω–∞—à–∏—è –∫–∞—Ç–∞–ª–æ–≥ –∑–∞ –¥–æ—Å—Ç—ä–ø–Ω–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."

Score: 0/100
```

#### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –î–µ—Ç–∞–π–ª–∏:**

**ProductFilter –ö–ª–∞—Å** (`src/retrieval/product_filter.py`):
```python
# –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏
keywords = ProductFilter.extract_keywords(query)

# –ü–æ—Å—Ç—Ä–æ—è–≤–∞–Ω–µ –Ω–∞ SQL —Ñ–∏–ª—Ç—ä—Ä —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–∏ —Ä–∞–∑—à–∏—Ä–µ–Ω–∏—è
where_clause = ProductFilter.build_filter_query(keywords)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –Ω–∏ —Ç—Ä—è–±–≤–∞ fallback
should_fallback = ProductFilter.should_use_fallback(results, min_results=2)

# –§–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –∑–∞ LLM
products_text = ProductFilter.format_products_for_llm(products)

# –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ LLM prompt
prompt = ProductFilter.create_llm_prompt(query, products_text, is_filtered=True)

# –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ keyword –∏ vector —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ
merged = ProductFilter.merge_results(keyword_results, vector_results)
```

**LLM Generator –ú–µ—Ç–æ–¥** (`src/chatbot/generator.py`):
```python
# –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä –æ—Ç custom prompt
answer = self.generator.generate_from_prompt(llm_prompt)
```

**RAG Pipeline** (`src/chatbot/rag.py`):
```python
# –ü—Ä–∏ products intent:
1. Extract keywords
2. Try keyword-based SQL filter with CATEGORY_MAP expansion (FAST)
3. If insufficient results ‚Üí Fallback to vector search (COMPREHENSIVE)
4. Merge results (keyword score 1.0, vector score similarity*0.75)
5. Format products
6. Generate LLM response
7. Return with adaptive score (95/85/75) + sources + search_method
```

#### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

‚úÖ **Two-tier Search** - Keyword –ø—ä—Ä–≤–æ (–±—ä—Ä–∑–æ), Vector fallback (–≤—Å–µ–æ–±—Ö–≤–∞—Ç–Ω–æ)
‚úÖ **Smart Fallback** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–º–∏–Ω–∞–≤–∞–Ω–µ –∫—ä–º vector search –ø—Ä–∏ –Ω—É–∂–¥–∞
‚úÖ **Intelligent Filtering** - –§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –ø–æ name, description –ò category
‚úÖ **LLM Formatting** - –ì–µ–Ω–µ—Ä–∏—Ä–∞ —á–æ–≤–µ—à–∫–∏ —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ —Å–ø–∏—Å—ä—Ü–∏
‚úÖ **Performance** - ~50-100ms –∑–∞ keyword, ~200-300ms –∑–∞ fallback
‚úÖ **Error Handling** - Graceful fallback –ø—Ä–∏ LLM –≥—Ä–µ—à–∫–∏
‚úÖ **Category Expansion** - –•–≤–∞—Ç–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å–∏–Ω–æ–Ω–∏–º–∏
‚úÖ **Case-insensitive Matching** - LOWER SQL —Ñ—É–Ω–∫—Ü–∏–∏
‚úÖ **Smart Merge** - –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ keyword + vector —Å –ø—Ä–∞–≤–∏–ª–Ω–∏ —Ç–µ–∂–µ—Å—Ç–∏
‚úÖ **Deduplication** - –í—Å–µ–∫–∏ –ø—Ä–æ–¥—É–∫—Ç —Å–∞–º–æ –≤–µ–¥–Ω—ä–∂
‚úÖ **Adaptive Scoring** - Score –æ—Ç—Ä–∞–∑—è–≤–∞ –º–µ—Ç–æ–¥–∞ –Ω–∞ —Ç—ä—Ä—Å–µ–Ω–µ (95/85/75)
‚úÖ **LLM Formatting** - –ì–µ–Ω–µ—Ä–∏—Ä–∞ —á–æ–≤–µ—à–∫–∏ —Ç–µ–∫—Å—Ç, –Ω–µ —Å–ø–∏—Å—ä—Ü–∏
‚úÖ **Performance** - ~50-100ms –∑–∞ keyword, ~200-300ms –∑–∞ hybrid

#### **Performance –ú–µ—Ç—Ä–∏–∫–∏ (–ê–∫—Ç—É–∞–ª–Ω–æ):**

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º–µ | –ú–µ—Ç–æ–¥ | –¢–æ—á–Ω–æ—Å—Ç | Score |
|----------|-------|-------|---------|-------|
| Keyword Extraction | 5-10ms | Regex | 98% | - |
| Category Expansion Lookup | 1-2ms | Dict match | 99% | - |
| SQL Keyword Filter | 20-50ms | ILIKE + CATEGORY_MAP | –í–∏—Å–æ–∫–∞ | 95 |
| Vector Embedding | 50-100ms | BGE-small | –°—Ä–µ–¥–Ω–∞ | - |
| Vector Search | 50-100ms | pgvector | –°—Ä–µ–¥–Ω–∞ | - |
| **Total (Keyword Only)** | **70-150ms** | **Keyword** | **–í–∏—Å–æ–∫–∞** | **95** |
| **Total (Hybrid Merge)** | **150-250ms** | **Keyword + Vector** | **–í–∏—Å–æ–∫–∞** | **85** |
| **Total (Vector FB)** | **150-250ms** | **Vector only** | **–°—Ä–µ–¥–Ω–∞** | **75** |

**üéØ Optimal Distribution:**
- 80% queries: Keyword match (95/100) - ~100ms
- 15% queries: Hybrid merge (85/100) - ~200ms  
- 5% queries: Vector only (75/100) - ~200ms

#### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```yaml
# config/config.yaml
products:
  max_results: 10              # –ú–∞–∫—Å–∏–º—É–º –ø—Ä–æ–¥—É–∫—Ç–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ
  keyword_match_method: "ilike" # Case-insensitive matching
  category_expansion: true     # –ò–∑–ø–æ–ª–∑–≤–∞–π CATEGORY_MAP
  llm_formatting: true         # –ò–∑–ø–æ–ª–∑–≤–∞–π LLM –∑–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ
  temperature: 0.7             # LLM creativity (0.0-1.0)
  
retrieval:
  min_keyword_results: 2       # –ú–∏–Ω–∏–º—É–º —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ OK
  vector_weight: 0.75          # –¢–µ–∂–µ—Å—Ç –∑–∞ vector —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ
  merge_deduplication: true    # –î–µ–¥—É–ø–ª–∏–∫–∏—Ä–∞–π —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –ú–æ–¥–µ–ª–∏

### **ü§ñ AI/ML –ú–æ–¥–µ–ª–∏:**

#### **Embedding Model:**
- **`BAAI/bge-m3`** (1024 dimensions)
  - Multilingual model —Å –æ—Ç–ª–∏—á–Ω–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –∑–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –µ–∑–∏–∫
  - –ü–æ-–¥–æ–±—Ä–æ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç bge-small-en-v1.5
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω –∑–∞ retrieval –∏ semantic search
  - –ü–æ–¥–¥—ä—Ä–∂–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –µ–∑–∏—Ü–∏ –µ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

#### **Large Language Model (LLM):**
- **`Qwen2.5:1.5b`** (–æ—Å–Ω–æ–≤–µ–Ω –º–æ–¥–µ–ª)
- **GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ** (3-5x –ø–æ-–±—ä—Ä–∑–æ)
- **Ollama integration** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—à–∏—Ä–∞–Ω–µ
- –°–ª—É–∂–∏ —á—Ä–µ–∑ **Ollama** –∑–∞ –ª–æ–∫–∞–ª–Ω–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω –∑–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –¥–∏–∞–ª–æ–≥

#### **Fine-tuning:**
- **LoRA (Low-Rank Adaptation)** —Å `mlx_lm`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω–µ –≤ GGUF —Ñ–æ—Ä–º–∞—Ç
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ollama –∑–∞ deployment

### **üß† –ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∏ –§—É–Ω–∫—Ü–∏–∏:**

#### **1. Intent Recognition (–†–∞–∑–ø–æ–∑–Ω–∞–≤–∞–Ω–µ –Ω–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏—è):**
```python
# –°–µ–º–∞–Ω—Ç–∏—á–Ω–æ —Ä–∞–∑–ø–æ–∑–Ω–∞–≤–∞–Ω–µ —Å precomputed embeddings
"–ö–∞–∫ —Å–µ –ø–ª–∞—â–∞?" ‚Üí payment intent (confidence: 0.85)
"–ö–æ–≥–∞ —â–µ –¥–æ–π–¥–µ –ø—Ä–∞—Ç–∫–∞—Ç–∞?" ‚Üí delivery intent (confidence: 0.78)
```

#### **2. Alias Normalization (–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–∏–Ω–æ–Ω–∏–º–∏):**
```python
# 40+ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–∏ —Ñ–æ—Ä–º–∏ ‚Üí –∫–∞–Ω–æ–Ω–∏—á–Ω–∏ –∑–∞—è–≤–∫–∏
"–ø—Ä–∏–µ–º–∞—Ç–µ –ª–∏ –∫–∞—Ä—Ç–∞" ‚Üí "–Ω–∞—á–∏–Ω–∏ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ"
"–∫–æ–≥–∞ —â–µ –¥–æ–π–¥–µ –ø—Ä–∞—Ç–∫–∞—Ç–∞" ‚Üí "–≤—Ä–µ–º–µ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞"
"–∏–º–∞ –ª–∏ –≥–∞—Ä–∞–Ω—Ü–∏—è" ‚Üí "–≥–∞—Ä–∞–Ω—Ü–∏—è –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∏"
```

#### **3. Query Expansion (–†–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ –Ω–∞ –∑–∞—è–≤–∫–∏):**
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ —Å–∏–Ω–æ–Ω–∏–º–∏
"–ø–ª–∞—â–∞" ‚Üí "–ø–ª–∞—â–∞–Ω–µ —Ä–∞–∑–ø–ª–∞—â–∞–Ω–µ –ø–∞—Ä–∏ —Ü–µ–Ω–∞ –∫–∞—Ä—Ç–∞ –ø—Ä–µ–≤–æ–¥"
"–¥–æ—Å—Ç–∞–≤–∫–∞" ‚Üí "–¥–æ—Å—Ç–∞–≤—è–Ω–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∫—É—Ä–∏–µ—Ä –∏–∑–ø—Ä–∞—â–∞–Ω–µ –ø—Ä–∞—Ç–∫–∞"
```

#### **4. Bulgarian Stemming (–ë—ä–ª–≥–∞—Ä—Å–∫–∞ –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è):**
```python
# –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞ –ø–æ-–¥–æ–±—Ä–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ
"–ø–ª–∞—â–∞–Ω–µ—Ç–æ" ‚Üí "–ø–ª–∞—â–∞"
"–¥–æ—Å—Ç–∞–≤–∫–∞—Ç–∞" ‚Üí "–¥–æ—Å—Ç–∞–≤–∫–∞"
"–≥–∞—Ä–∞–Ω—Ü–∏—è—Ç–∞" ‚Üí "–≥–∞—Ä–∞–Ω—Ü–∏—è"
```

#### **5. Hybrid Search (–•–∏–±—Ä–∏–¥–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ):**
- **–í–µ–∫—Ç–æ—Ä–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ** (—Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ —Å—Ö–æ–¥—Å—Ç–≤–æ)
- **Keyword —Ç—ä—Ä—Å–µ–Ω–µ** (PostgreSQL full-text search)
- **–ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–æ scoring** —Å –Ω–∞—Å—Ç—Ä–æ–π–≤–∞–µ–º–∞ —Ç–µ–∂–µ—Å—Ç (alpha=0.6)

### **üèó –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

#### **–û—Å–Ω–æ–≤–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:**
- **Python 3.11+** - –æ—Å–Ω–æ–≤–µ–Ω –µ–∑–∏–∫
- **PostgreSQL 16 + pgvector** - –≤–µ–∫—Ç–æ—Ä–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏
- **FastAPI** - web API framework
- **Docker & Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Ollama** - –ª–æ–∫–∞–ª–µ–Ω LLM serving

#### **Performance –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- **Precomputed embeddings** –∑–∞ canonical queries (10-20x —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
- **Ollama warmup** –∑–∞ –ø–æ-–±—ä—Ä–∑ —Å—Ç–∞—Ä—Ç (3-4 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 90 —Å–µ–∫)
- **Retry logic** —Å exponential backoff
- **Connection pooling** –∑–∞ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏
- **Hybrid search** —Å –Ω–∞—Å—Ç—Ä–æ–π–≤–∞–µ–º–∞ —Ç–µ–∂–µ—Å—Ç (alpha=0.6)

### **üìä Performance –ú–µ—Ç—Ä–∏–∫–∏:**

#### **Intent Recognition:**
- **Precomputed embeddings**: 10-20x –ø–æ-–±—ä—Ä–∑–æ –æ—Ç real-time encoding
- **Confidence threshold**: 0.45 (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω –∑–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏)
- **Alias matching**: < 1ms –∑–∞ 40+ patterns
- **Keyword fallback**: < 5ms –∑–∞ 15+ keywords

#### **Query Processing:**
- **Alias normalization**: < 1ms
- **Bulgarian stemming**: < 0.5ms
- **Query expansion**: < 2ms
- **Total processing**: < 10ms

#### **Retrieval Performance:**
- **Vector search**: ~50ms (384-dim embeddings)
- **Keyword search**: ~20ms (PostgreSQL full-text)
- **Hybrid scoring**: ~5ms
- **Total retrieval**: ~75ms

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∏

### **RAG Pipeline:**
1. **Query Processing** - –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –∑–∞–¥–∞–≤–∞ –≤—ä–ø—Ä–æ—Å
2. **Alias Normalization** - –ù–æ—Ä–º–∞–ª–∏–∑–∏—Ä–∞ —Å–∏–Ω–æ–Ω–∏–º–∏ –∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–∏ —Ñ–æ—Ä–º–∏
3. **Double-pass Semantic Check** - –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞ –∑–∞–ø–∞–∑–≤–∞ —Å–º–∏—Å—ä–ª–∞
4. **Morphological Fallback** - –•–≤–∞—â–∞ –≥–ª–∞–≥–æ–ª–Ω–∏ —Ñ–æ—Ä–º–∏ –∫–∞—Ç–æ "–ü–ª–∞—â–∞ –ª–∏ —Å–µ?"
5. **Intent Recognition** - –°–µ–º–∞–Ω—Ç–∏—á–Ω–æ —Ä–∞–∑–ø–æ–∑–Ω–∞–≤–∞–Ω–µ —Å precomputed embeddings
6. **Query Expansion** - –î–æ–±–∞–≤—è —Å–∏–Ω–æ–Ω–∏–º–∏ –∏ context boosters
7. **Hybrid Retrieval** - –ö–æ–º–±–∏–Ω–∏—Ä–∞ vector + keyword —Ç—ä—Ä—Å–µ–Ω–µ
8. **Source Filtering** - –§–∏–ª—Ç—Ä–∏—Ä–∞ –ø–æ —Ç–∞–±–ª–∏—Ü–∏ (policies/faq/products)
9. **Score Calculation** - –ò–∑—á–∏—Å–ª—è–≤–∞ confidence score (0-100)
10. **Answer Generation** - –ì–µ–Ω–µ—Ä–∏—Ä–∞ –æ—Ç–≥–æ–≤–æ—Ä (–∞–∫–æ score ‚â• 80) –∏–ª–∏ "–¢–æ–≤–∞ –Ω–µ –µ –≤ –º–æ—è—Ç–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è"
11. **Bulgarian Post-Processing** - –ò–∑–≥–ª–∞–∂–¥–∞ –≥—Ä–∞–º–∞—Ç–∏–∫–∞ –∏ —Å—Ç–∏–ª —Å compiled patterns
12. **Response** - –í—Ä—ä—â–∞ –æ—Ç–≥–æ–≤–æ—Ä —Å –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ –∏ score

### **Hybrid Search:**
```
hybrid_score = Œ± √ó vector_similarity + (1-Œ±) √ó keyword_score
```
- **Œ± = 0.6** (60% vector, 40% keyword –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ)
- **Vector search**: pgvector cosine similarity
- **Keyword search**: PostgreSQL full-text search —Å tsvector

### **Score –∫–∞–ª–∫—É–ª–∞—Ü–∏—è:**
```
score = ((similarity - 0.2) / (0.8 - 0.2)) * 100
```
- similarity ‚â§ 0.2 ‚Üí score 0
- similarity ‚â• 0.8 ‚Üí score 100
- **–ü—Ä–∞–≥**: 80 (–Ω–∞—Å—Ç—Ä–æ–π–≤–∞–µ–º)

### **üß† Advanced Intent Processing:**
```
"–ü–ª–∞—â–∞ –ª–∏ —Å–µ?" ‚Üí Morphological Fallback ‚Üí "–Ω–∞—á–∏–Ω–∏ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ" ‚Üí payment intent
"–ö–∞–∫ —Å–µ –ø–ª–∞—â–∞?" ‚Üí Alias Normalization ‚Üí "–Ω–∞—á–∏–Ω–∏ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ" ‚Üí payment intent  
"–ö–æ–≥–∞ —â–µ –¥–æ–π–¥–µ?" ‚Üí Context Boost ‚Üí "–¥–æ—Å—Ç–∞–≤–∫–∞ –∫—É—Ä–∏–µ—Ä —Å—Ä–æ–∫" ‚Üí delivery intent
"–ö–∞–∫–≤–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –∏–º–∞—Ç–µ?" ‚Üí Products Handler ‚Üí SQL Query ‚Üí 10 –ø—Ä–æ–¥—É–∫—Ç–∏ —Å —Ü–µ–Ω–∏
```

### **üõçÔ∏è Products Query Examples:**
```
–í—ä–ø—Ä–æ—Å: "–ü—Ä–µ–¥–ª–∞–≥–∞—Ç–µ –ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏?"
–û—Ç–≥–æ–≤–æ—Ä: 1. **–°–º–∞—Ä—Ç—Ñ–æ–Ω Samsung Galaxy S23** - 1899.00 –ª–≤
         –§–ª–∞–≥–º–∞–Ω—Å–∫–∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å 6.1-–∏–Ω—á–æ–≤ Dynamic AMOLED 2X –µ–∫—Ä–∞–Ω...

–í—ä–ø—Ä–æ—Å: "–ò–º–∞—Ç–µ –ª–∏ –ª–∞–ø—Ç–æ–ø–∏?"  
–û—Ç–≥–æ–≤–æ—Ä: 1. **–õ–∞–ø—Ç–æ–ø Dell XPS 13** - 2499.00 –ª–≤
         –í–∏—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω —É–ª—Ç—Ä–∞–±—É–∫ —Å 13.4-–∏–Ω—á–æ–≤ InfinityEdge –¥–∏—Å–ø–ª–µ–π...
```

### **‚ö° Performance Features:**
- **Compiled regex patterns** - 3-5x –ø–æ-–±—ä—Ä–∑–æ post-processing
- **Semantic stability check** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ –≥—Ä–µ—à–Ω–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- **Context boosters** - –¥–æ–±–∞–≤—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ —Ç–µ—Ä–º–∏–Ω–∏ –∑–∞ –≤—Å–µ–∫–∏ intent
- **Dynamic synonym weighting** - —Å–∞–º–æ –Ω–∞–π-—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ç–µ 3 —Å–∏–Ω–æ–Ω–∏–º–∞
- **Timeout optimization** - —Å—Ç–∞–±–∏–ª–Ω–∏ 120s timeout –∑–∞ Ollama

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
mini-rag-chatbot/
‚îú‚îÄ‚îÄ src/                    # –û—Å–Ω–æ–≤–µ–Ω –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ api/               # FastAPI endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py      # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.py      # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ chatbot/          # RAG –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rag.py         # –û—Å–Ω–æ–≤–µ–Ω RAG pipeline
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ generator.py   # LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/          # DB –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py      # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.py          # DB –≤—Ä—ä–∑–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ indexing/          # Embeddings
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ embeddings.py  # BGE-small –º–æ–¥–µ–ª
‚îÇ   ‚îú‚îÄ‚îÄ retrieval/         # –¢—ä—Ä—Å–µ–Ω–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ retriever.py   # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hybrid_retriever.py  # Hybrid search
‚îÇ   ‚îî‚îÄ‚îÄ frontend/          # Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ       ‚îî‚îÄ‚îÄ index.html     # React-–ø–æ–¥–æ–±–µ–Ω UI
‚îú‚îÄ‚îÄ scripts/               # –°–∫—Ä–∏–ø—Ç–æ–≤–µ
‚îÇ   ‚îú‚îÄ‚îÄ prepare_data.py    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –¥–∞–Ω–Ω–∏
‚îÇ   ‚îú‚îÄ‚îÄ build_index.py     # –ò–Ω–¥–µ–∫—Å–∏—Ä–∞–Ω–µ
‚îÇ   ‚îú‚îÄ‚îÄ lora_training_bulgarian.py  # LoRA training
‚îÇ   ‚îî‚îÄ‚îÄ test_client.py     # –¢–µ—Å—Ç –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ data/                  # –î–∞–Ω–Ω–∏
‚îÇ   ‚îú‚îÄ‚îÄ sample_seed.sql    # –ü—Ä–∏–º–µ—Ä–Ω–∏ –¥–∞–Ω–Ω–∏
‚îÇ   ‚îî‚îÄ‚îÄ init.sql           # DB –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker/                # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile         # Container build
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml # Services orchestration
‚îî‚îÄ‚îÄ config/                # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    ‚îú‚îÄ‚îÄ config.yaml        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ settings.py         # Pydantic settings
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### **–ú–æ–¥–µ–ª–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- **Embeddings**: `BAAI/bge-m3` (1024 dim)
- **LLM**: `qwen2.5:1.5b` (via Ollama)
- **Database**: PostgreSQL 16 + pgvector extension
- **Score threshold**: 80
- **Bulgarian lemmatization**: simplemma
- **Top-K retrieval**: 5
- **Hybrid alpha**: 0.6 (60% vector, 40% keyword)

### **Docker Services:**
- **postgres**: PostgreSQL —Å pgvector
- **rag-chatbot**: FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **adminer**: Database management
- **lora-train**: LoRA training (profile: lora)

## üß† –ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∏ –§—É–Ω–∫—Ü–∏–∏ –≤ –î–µ–π—Å—Ç–≤–∏–µ

### **–ü—Ä–∏–º–µ—Ä 1: Intent Recognition**
```bash
# –í—Ö–æ–¥: "–ö–∞–∫ —Å–µ –ø–ª–∞—â–∞?"
# –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Alias normalization: "–∫–∞–∫ —Å–µ –ø–ª–∞—â–∞" ‚Üí "–Ω–∞—á–∏–Ω–∏ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ"
2. Intent recognition: payment (confidence: 0.85)
3. Query expansion: "–Ω–∞—á–∏–Ω–∏ –ø–ª–∞—â–∞–Ω–µ —Ä–∞–∑–ø–ª–∞—â–∞–Ω–µ –ø–∞—Ä–∏ —Ü–µ–Ω–∞"
4. Hybrid search: –Ω–∞–º–∏—Ä–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑–∞ –ø–ª–∞—â–∞–Ω–µ
```

### **–ü—Ä–∏–º–µ—Ä 2: Bulgarian Stemming**
```bash
# –í—Ö–æ–¥: "–ü–ª–∞—â–∞–Ω–µ—Ç–æ —Å –∫–∞—Ä—Ç–∞"
# –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Stemming: "–ø–ª–∞—â–∞–Ω–µ—Ç–æ" ‚Üí "–ø–ª–∞—â–∞"
2. Alias match: "–ø–ª–∞—â–∞" ‚Üí "–Ω–∞—á–∏–Ω–∏ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ"
3. Intent: payment (confidence: 0.78)
```

### **–ü—Ä–∏–º–µ—Ä 3: Query Expansion**
```bash
# –í—Ö–æ–¥: "–î–æ—Å—Ç–∞–≤–∫–∞—Ç–∞"
# –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Stemming: "–¥–æ—Å—Ç–∞–≤–∫–∞—Ç–∞" ‚Üí "–¥–æ—Å—Ç–∞–≤–∫–∞"
2. Alias match: "–¥–æ—Å—Ç–∞–≤–∫–∞" ‚Üí "–≤—Ä–µ–º–µ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞"
3. Synonyms: "–¥–æ—Å—Ç–∞–≤—è–Ω–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∫—É—Ä–∏–µ—Ä –∏–∑–ø—Ä–∞—â–∞–Ω–µ –ø—Ä–∞—Ç–∫–∞"
4. Final query: "–≤—Ä–µ–º–µ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–æ—Å—Ç–∞–≤—è–Ω–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∫—É—Ä–∏–µ—Ä"
```

### **–ü—Ä–∏–º–µ—Ä 4: Keyword Fallback**
```bash
# –í—Ö–æ–¥: "–ü—Ä–∏–µ–º–∞—Ç–µ –ª–∏ –∫–∞—Ä—Ç–∞?"
# –û–±—Ä–∞–±–æ—Ç–∫–∞:
1. Alias match: "–ø—Ä–∏–µ–º–∞—Ç–µ –ª–∏ –∫–∞—Ä—Ç–∞" ‚Üí "–Ω–∞—á–∏–Ω–∏ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ"
2. Intent recognition: payment (confidence: 0.45)
3. Keyword fallback: "–∫–∞—Ä—Ç–∞" ‚Üí payment intent
4. Final intent: payment (confidence: 0.55)
```

---

## üìö –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### **üîó GitHub Repository**
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [https://github.com/SrebrinSharbanov/ChatBot](https://github.com/SrebrinSharbanov/ChatBot)
- **–õ–∏—Ü–µ–Ω–∑**: MIT
- **–í–µ—Ä—Å–∏—è**: 1.0.0

### **üìã –í—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞ –†–∞–∑—à–∏—Ä–µ–Ω–∏–µ**
- –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤—ä–Ω—à–Ω–∏ API –∑–∞ —Ü–µ–Ω–∏ –∏ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç
- –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –µ–∑–∏—Ü–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM —Å–∏—Å—Ç–µ–º–∏
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç–∏ –∑–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ

### **ü§ù –ü—Ä–∏–Ω–æ—Å –∫—ä–º –ü—Ä–æ–µ–∫—Ç–∞**
1. Fork –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ç–∞
2. –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ feature branch
3. –ù–∞–ø—Ä–∞–≤—è–Ω–µ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
4. –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ Pull Request

### **üìû –ü–æ–¥–¥—Ä—ä–∂–∫–∞**
- **Issues**: [GitHub Issues](https://github.com/SrebrinSharbanov/ChatBot/issues)
- **Discussions**: [GitHub Discussions](https://github.com/SrebrinSharbanov/ChatBot/discussions)
- **Email**: srebrin.sharbanov@gmail.com